<!DOCTYPE html>
<html>
<head>
    <title>Coral Database</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.css">
    <style>
        h1 {
            text-align: center;
            font-size: 30px;
        }
        table {
            border-collapse: collapse;
            width: auto;  
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #C68939;
        }
		.scroll {
		height: 400px; 
		overflow-y: auto;
		border: 1px solid ;
		padding: 10px;
		}
        .user-input {
            border: 1px solid ;
            padding: 10px;
            margin-bottom: 20px;
        }
        .slidecontainer {
            width: 50%;
        }
        .example-text {
            margin-left: 10px;
        }
        .tabbar {
            display: flex;
            width: auto;
            justify-content: space-between;
            background-color: #f1f1f1;
            padding: 10px;
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
        }
        .tab {
            flex-grow: 1;
            text-align: center;
            cursor: pointer;
        }
        .tab.active {
            background-color: #ccc;
            box-shadow: none;
        }
        .tabcontent {
            display: none;
        }
        .active-tabcontent {
            display: block;
        }
        .collapsible {
            background-color: #777;
            color: white;
            cursor: pointer;
            padding: 12px;
            width: auto;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
            display: flex;
            align-items: center;
        }
        .collapsible.active, .collapsible:hover {
            background-color: #555;
        }
        .collapsible::before {
            content: "\25BA";
            margin-right: 10px;
        }
        .active.collapsible::before {
            content: "\25BC";
        }
        .content {
            padding: 0 18px;
            display: none;
            overflow: hidden;
            background-color: #f1f1f1;
        }
        .submit_button {
            height:40px;
            width:75px;
            border-radius: 25px;
        }
        .hover-value {
            font-size: 15px;
            margin-top: 5px;
        }
        .noUi-value {
            color: black; 
            font-size: 15px;
        }
		.highlight {
			background-color: #FFEA00;
			transition: background-color 1s ease-in-out;
		}
		.noUi-connect, .progress-bar {
			background-color: #C68939;
		}
		
    </style>
</head>
<body>
    <h1><strong>Porites (Stony Coral) Database</strong></h1>
    
    <!-- --------------
        WEBSITE TABS 
    ---------------- -->
    <div class="tabbar">
        <div class="tab" onclick="openTab(event, 'intro')">Home</div>
        <div class="tab" onclick="openTab(event, 'data')">Data</div>
        <div class="tab" onclick="openTab(event, 'media')">Media</div>
        <div class="tab" onclick="openTab(event, 'help')">Help</div>
    </div>

    <!-- ------------------
        INTRODUCTION TAB
    -------------------- -->
    <div id="intro" class="tabcontent active-tabcontent"><br>
        <div class="user-input">
			<p><strong>Project Name: </strong>A Comprehensive Database for Coral Diversity in Turneffe Atoll</p>
			<p><strong>Student Developers: </strong>Johnathan Zhang, Saumya Pothukuchi, Zachary Derse, Grace Aboussleman</p>
			<p><strong>Faculty Advisor: </strong> Dr. John Finnerty, Department of Biology Department & BU Marine Program
			<p><strong>Statement: </strong> This project was developed at Boston University as part of BF768, Spring 2024, under Prof. Gary Benson as the instructor.</p>
            <p><strong>Abstract: </strong>For the past decade, the Finnerty lab has collected multiple data types surrounding coral reef populations in Turneffe Atoll Marine Reserve, Belize, for the coral species Finger Coral (Porites porites). 
			The data is divided into two main categories: phenotypic and variant call data (vcf data). The phenotypic data is further divided into location information, ecological volume (area covered by a coral colony),
			Tag IDs, which are the IDs by which the coral can be recognised, etc.</p> 
        </div>
    </div>

    <!-- ---------------------
        DATABASE SEARCH TAB
    ----------------------- -->
    <div id="data" class="tabcontent">
        <p style="font-size:18px;">This tab allows the user to explore the coral phenotypic and vcf data. The data can also be filtered by the options present in the filters section.</p>
        <div class="user-input">
            <!-- All Filters -->
            <div class="collapsible">Filters</div>
            <div class="content">
                <br>
                Input Tag ID: <input type="text" id="tagid">
                <span class="example-text">(Example Tag IDs: )</span>&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_tagid')" id="tagid_help">TagID Help</a>
                <p style="font-size:17px;text-align: left;"><strong>OR</strong></p>
                Input Scaffold: <input type="text" id="scaffold">
                <span class="example-text">(Example Scaffolds: )</span>&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_scaffoldid')" id="scaffold_help">Scaffold Help</a> <br><br>

                Link phenotypic data to VCF data? (Choose <strong>Yes</strong> if VCF Filters need to be used):&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_linkingvcf')" id="vcflinking_help">Linking VCF Help</a><br>
				<select name="vcf">
					<option value="Yes">Yes</option>
					<option value="No" selected>No</option>
				</select>
                <br><br>
                <!-- Phenotypic Data Filters -->
                <div class="collapsible">Phenotypic Data Filters</div>
                <div class="content"><br>
                    
                        Year: <input type="checkbox" name="year" value="2015" checked> 2015
                        <input type="checkbox" name="year" value="2016"> 2016
                        <input type="checkbox" name="year" value="2017"> 2017
                        <input type="checkbox" name="year" value="2018"> 2018
						<a href="#" onclick="openTab(event, 'help', 'help_year')" id="year_help">Year Help</a><br><br>

                        Location: <input type="checkbox" name="location" value="Channel-North"> Channel-North
                        <input type="checkbox" name="location" value="Channel-South"> Channel-South
                        <input type="checkbox" name="location" value="Creek-West"> Creek-West
                        <input type="checkbox"  name="location" value="Creek-East"> Creek-East
						<a href="#" onclick="openTab(event, 'help', 'help_location')" id="location_help">Location Help</a><br><br>

                        Mortality: <input type="checkbox" name="mortality" value="Alive"> Alive
                        <input type="checkbox" name="mortality" value="Missing"> Missing
                        <input type="checkbox" name="mortality" value="Dead"> Dead
                        <input type="checkbox" name="mortality" value="New"> New
						<a href="#" onclick="openTab(event, 'help', 'help_mortality')" id="mortality_help">Mortality Help</a><br><br>
						
						<div class="slidecontainer">
                        Ecological Volume (units):&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_eco_vol')" id="eco_vol_help">Ecological Volume Help</a>
						<div id="eco_vol_value" class="hover-value"></div><br>
                        <div id="eco_vol"></div>
                        <br><br><br>

                        Natural Log of Ecological Volume (units):&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_ln_eco_vol')" id="ln_eco_vol_help">LN Ecological Volume Help</a>
						<div id="ln_eco_vol_value" class="hover-value"></div><br>
                        <div id="ln_eco_vol"></div>
                        <br><br><br>

                        Length (cm):&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_length')" id="length_help">Length Help</a>
						<div id="length_value" class="hover-value"></div><br>
                        <div id="length"></div>
                        <br><br><br>
						
						Width (cm):&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_width')" id="width_help">Width Help</a>
						<div id="width_value" class="hover-value"></div><br>
                        <div id="width"></div>
                        <br><br><br>
						
						Height (cm):&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_height')" id="height_help">Height Help</a>
						<div id="height_value" class="hover-value"></div><br>
                        <div id="height"></div>
                        <br><br><br>
                    </div>
                </div>
                <br>

                <!-- VCF Data Filters -->
                <div class="collapsible">VCF Filters</div>
                <div class="content"><br>
                    <div class="slidecontainer">
                        Allele Frequency:&nbsp;&nbsp;&nbsp;<a href="#" onclick="openTab(event, 'help', 'help_allele_freq')" id="allele_freq_help">Allele Frequency Help</a>
						<div id="allele_freq_value" class="hover-value"></div><br>
                        <div id="allele_freq"></div><br><br><br>
                    </div>
                </div>
                <br>

                <!-- Advanced Data Filters -->
                <div class="collapsible">Advanced Data Filters</div>
                <div class="content"><br>
                    <p> This section allows grouping of data based on either location or mortality which can be used to evaluate aggregate functions of interet.</p>
                    
                        <p><strong>Aggregate Functions:</strong></p>
                        Count of: <input type="checkbox" name="count" value="Alive"> Alive corals
                            <input type="checkbox" name="count" value="Dead"> Dead/Missing corals
                            <input type="checkbox" name="count" value="New"> New corals
                            <input type="checkbox" name="count" value="tip_number"> Tip Number
							<a href="#" onclick="openTab(event, 'help', 'help_count')" id="count_help">Count Help</a><br><br>
                        
                        Average of: <input type="checkbox" name="average" value="Alive"> Alive corals
                            <input type="checkbox" name="average" value="Dead"> Dead/Missing corals
                            <input type="checkbox" name="average" value="New"> New corals
                            <input type="checkbox" name="average" value="tip_number"> Tip Number
							<a href="#" onclick="openTab(event, 'help', 'help_average')" id="average_help">Average function Help</a><br><br>
                        <hr>
                        <strong>Group by:</strong> <input type="checkbox" name="groupby" value="location"> Locations
                            <input type="checkbox" name="groupby" value="alive_status"> Mortality
							<a href="#" onclick="openTab(event, 'help', 'help_groupby')" id="groupby_help">Groupby Help</a><br><br>
                </div>
                </div>
                 <br>

                <!-- ?????????????? WE SHOULD ADD ANOTHER DROPDOWN FOR ADVANCED FILTERS
                LIKE GROUP BY, COUNT, AGGREGATE FUNCTIONS...-->
                <button class = "submit_button" id="get_table_button" type="button">Submit</button><br><br>
                <button class = "submit_button" id="csv_button" type="button">Download csv</button><br><br>
            </div>
        </div>
    </div>
	
    <!-- Output data table -->     <!-- DOES THIS GO HERE???????????????????-->
    <div id="out_table"></div>
    <div id="store_results"></div>         <!-- Random div to store results of query (for download button?)-->
    

    <!-- ----------- 
        MEDIA TAB
    ------------- -->
    <div id="media" class="tabcontent"><br>
        <div class="user-input">
            Link to coral pics
        </div>
    </div>

    <!-- ---------
        HELP TAB
    ----------- -->
    <div id="help" class="tabcontent"><br>
        <div class="user-input">
            <p style="font-size:17px;"><strong>The steps below can be used as a guide to navigate the site:</strong></p>
			<ol>
				<li>Input Tag ID</li>
			</ol>	
			<br>
			<p style="font-size:17px;"><strong>Further information on each tab/filter which can be found below:</strong></p>
            <ol>
				<br>
                    <button class="collapsible">Input Tag ID/ Scaffold ID</button>
					<div class="content">
					 <ul>
						<p>A straightforward way to retrieve information on a particular coral is to input a Tag ID or Scaffold ID of interest. Note that it is possible for multiple SNPs to exist per scaffold.
							</p>
						<li>
							<p><a id="help_tagid">Tag ID:</a></p>
							<ul>
								<li> Tag IDs are used to uniquely identify each coral.</li>
								<li> Some corals have phenotypic data across years and would share a common tag ID. </li>
							</ul>
						</li>
						<li>
							<p><a id="help_scaffoldid">Scaffold ID:</a></p>
							<ul>
								<li> Scaffold IDs are used to identify variant information present in the VCF.</li>
								<li> These are not unique values, and multiple corals can have the same variants/corresponding Scaffold IDs. </li>
							</ul>
						</li>	
						<p>If there are other filters which need to be applied to then they can be selected from the Phenotypic Data Filter tab or the VCF Filter tab. 
							(See below for further details on those sections)
						</p>
					</ul>
                    <br>
					</div>
                <br>
                    <button class="collapsible">Phenotypic Data Filters</button>
					<div class="content">
					<ul>
					
						<li>
							<p><a id="help_location">Location:</a></p>
							<ul>
								<li>There are 4 locations from where coral data was collected from: Channel-North, Channel-South, Creek-West and Creek-East.</li>
								<li>There are checkboxes present to select the locations of interest, and multiple locations can be selected if desired.</li>
								<li>The locations selected are the <strong>ONLY</strong> ones which will be returned. It should be left blank if all values are of interest.</li>
							</ul>	
						</li>						
						<li>
							<p><a id="help_year">Year:</a></p>
							<ul>
								<li>Similar to location, the year filter allows the user to filter data based on the year of interest. Data was collected over 4 years: 2015, 2016, 2017 and 2018.</li>
								<li>Checkboxes are present to select the years of interest, and multiple years can be selected if desired.</li>
								<li>The years selected are the ONLY ones which will be returned. </li>
								<li><strong>Year CANNOT BE BLANK due to the nature of the dataset and the default year is 2015.</strong></li>
							</ul>
						</li>
						<li>
							<p><a id="help_mortality">Mortality:</a></p>
							<ul>
								<li>Similar to other checkbox filters, the mortality filter allows the user to filter data based whether the coral of interest on Alive/Dead/Missing/New.
                                    New refers to the corals that are alive but have started being tracked in that particular year. An older coral would be under alive in the later years.
                                </li>
								<li>There are many corals which correspond to dead <strong>OR</strong> missing since determining the cause of disappearance is difficult. 
								The corals with both values will be returned irrespective of whether dead is chosen or missing.It should be left blank if all values are of interest.</li>
								<li>This filter is particularly useful in combination with the year filter to study the survivalship of the corals of interest.</li>
							</ul>
						</li>
                        <li>
							<p><a id="help_eco_vol">Ecological Volume:</a></p> 
							<ul>
								<li>Refers to the volume which is occupied by the coral colony. </li>
								<li>Slider can be used to pick a cutoff value (i.e, all corals with volume <strong>LESS THAN</strong> the selected value will be returned). It should be left at default 0 if all values are of interest.</li>
								<li>The sliders number is updated dynamically above the slider and can be used to pick cutoff values with increased sensitivity.</li>
							</ul>
						</li>
						<li>
							<p><a id="help_ln_eco_vol">Natural Log of Ecological Volume:</a></p>
							<ul>
								<li>Natural log of ecological volume.</li>
								<li>Slider can be used to pick a cutoff value (i.e, all corals with volume <strong>LESS THAN</strong> the selected value will be returned). It should be left at default 0 if all values are of interest.</li>
								<li>The sliders number is updated dynamically above the slider and can be used to pick cutoff values with increased sensitivity.</li>
							</ul>
						</li>	
                        <li>
							<p><a id="help_length">Length:</a></p>
							<ul>
								<li>Length of coral polyp in centimeter.</li>
								<li>Slider can be used to pick a cutoff value (i.e, all corals with polyp length <strong>LESS THAN</strong> the selected value will be returned). It should be left at default 0 if all values are of interest.</li>
								<li>The sliders number is updated dynamically above the slider and can be used to pick cutoff values with increased sensitivity.</li>
							</ul>
						</li>
                        <li>
							<p><a id="help_width">Width:</a></p>
							<ul>
								<li>Width of coral polyp in centimeter.</li>
								<li>Slider can be used to pick a cutoff value (i.e, all corals with polyp width <strong>LESS THAN</strong> the selected value will be returned). It should be left at default 0 if all values are of interest.</li>
								<li>The sliders number is updated dynamically above the slider and can be used to pick cutoff values with increased sensitivity.</li>
							</ul>
						</li>
                        <li>
							<p><a id="help_height">Height:</a></p>
							<ul>
								<li>Height of coral polyp in centimeter.</li>
								<li>Slider can be used to pick a cutoff value (i.e, all corals with polyp height <strong>LESS THAN</strong> the selected value will be returned). It should be left at default 0 if all values are of interest.</li>
								<li>The sliders number is updated dynamically above the slider and can be used to pick cutoff values with increased sensitivity.</li>
							</ul>
						</li>						
					</ul>
                    <br>
					</div>
				<br>
				<button class="collapsible"> VCF Filters</button>
					<div class="content">
					<ul>
						<li>
							<p><a id="help_allele_freq">Allele Frequency:</a></p> 
							<ul>
								<li>Allele frequency refers to the relative frequency of the variant at a particular locus. 
								This is an important metric since it can be used to study the fraction of all chromosomes in the population 
								that carry that allele over the sample size, espeically if it can potentially make corals resilient for better survivalship.</li>
								<li>Slider can be used to pick a cutoff value (i.e, all corals with allele frequency <strong>LESS THAN</strong> the selected value will be returned). It should be left at default 0 if all variants are of interest.</li>
								<li>The sliders number is updated dynamically above the slider and can be used to pick cutoff values with increased sensitivity.</li>
							</ul>
						</li>
					</ul>
                    <br>
					</div>	
            </ol>
        </div>
    </div>

    <!-- ------------------------
        JAVASCRIPT/JQUERY/AJAX
    --------------------------- -->
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/wnumb/1.2.0/wNumb.min.js"></script>

    <!-- Main -->
    <script>
        //////////////////////////
        //  JAVASCRIPT FOR UI   //
        //////////////////////////

		function openTab(evt, tabName, scrollToTab) {
			// Open the specified tab
			var i, tabcontent, tablinks;
			tabcontent = document.getElementsByClassName("tabcontent");
			for (i = 0; i < tabcontent.length; i++) {
				tabcontent[i].style.display = "none";
			}
			tablinks = document.getElementsByClassName("tab");
			for (i = 0; i < tablinks.length; i++) {
				tablinks[i].classList.remove("active");
			}
			document.getElementById(tabName).style.display = "block";
			evt.currentTarget.classList.add("active");

			// Check if the current tab is the help tab
			if (tabName !== 'help') {
				// Close all collapsible sections within the help tab
				var helpCollapsibleButtons = document.querySelectorAll('#help .collapsible');
				helpCollapsibleButtons.forEach(function(collapsibleButton) {
					collapsibleButton.classList.remove('active');
					var content = collapsibleButton.nextElementSibling;
					content.style.display = 'none';
				});
			}

			// Scroll to the specified tab and uncollapse the corresponding section
			if (scrollToTab) {
				var helpSectionId = scrollToTab;
				var helpSection = document.getElementById(helpSectionId);
				if (helpSection) {
					// Uncollapse the corresponding section
					var collapsibleButton = helpSection.closest('.content').previousElementSibling;
					if (collapsibleButton && collapsibleButton.classList.contains('collapsible')) {
						collapsibleButton.classList.add('active');
						var content = collapsibleButton.nextElementSibling;
						if (content.style.display === 'block') {
							content.style.display = 'none';
						} else {
							content.style.display = 'block';
						}
					}
					// Add highlight class temporarily
					helpSection.classList.add('highlight');
					setTimeout(function() {
						// Remove highlight class after 2 seconds
						helpSection.classList.remove('highlight');
					}, 2000);
					// Scroll to the help section
					helpSection.scrollIntoView({ behavior: 'smooth' });
				}
			}
		}

        // Collapsible section functionality
        var coll = document.getElementsByClassName("collapsible");
        var i;

        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                console.log("Clicked!");
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                }
            });
        }
		coll[0].click();

		// Sliders
        var ecoVolSlider = document.getElementById('eco_vol');
		var ecoVol_field = document.getElementById('eco_vol_value');
        var lnEcoVolSlider = document.getElementById('ln_eco_vol');
		var lnVol_field = document.getElementById('ln_eco_vol_value');
        var alleleFreqSlider = document.getElementById('allele_freq');
		var allele_field = document.getElementById('allele_freq_value');
        var lengthSlider = document.getElementById('length');
		var length_field = document.getElementById('length_value');
		var widthSlider = document.getElementById('width');
		var width_field = document.getElementById('width_value');
		var heightSlider = document.getElementById('height');
		var height_field = document.getElementById('height_value');
        var count = document.getElementById('count');
        var average = document.getElementById('average');
        var groupby = document.getElementById('groupby');
        var vcf = document.getElementById('vcf');

        noUiSlider.create(ecoVolSlider, {
            start: [0],
			tooltips: true,
			connect: 'lower',
			behaviour: 'hover-snap',
            range: {
                'min': 0,
                'max': 35000
            },
            pips: {
                mode: 'values',
                values: [0, 10000, 20000, 30000, 35000],
                density: 4
            }
        });
		ecoVolSlider.noUiSlider.on('update', function (values, handle) {
			ecoVol_field.innerHTML = values[handle];
		});
		
        noUiSlider.create(lnEcoVolSlider, {
            start: [0],
			tooltips: true,
			connect: 'lower',
			behaviour: 'hover-snap',
            range: {
                'min': -4,
                'max': 12
            },
            pips: {
                mode: 'values',
                values: [-4, 0, 4, 8, 12],
                density: 4
            }
        });
		lnEcoVolSlider.noUiSlider.on('update', function (values, handle) {
			lnVol_field.innerHTML = values[handle];
		});

        noUiSlider.create(alleleFreqSlider, {
            start: [0],
			tooltips: true,
			connect: 'lower',
			behaviour: 'hover-snap',
            range: {
                'min': 0,
                'max': 1
            },
            pips: {
                mode: 'values',
                values: [0, 0.25, 0.5, 0.75, 1],
                density: 4
            },
			format: wNumb( { decimals: 2 })
        });
		alleleFreqSlider.noUiSlider.on('update', function (values, handle) {
			allele_field.innerHTML = values[handle];
		});

        noUiSlider.create(lengthSlider, {
            start: [0],
			tooltips: true,
			connect: 'lower',
			behaviour: 'hover-snap',
            range: {
                'min': 0,
                'max': 50
            },
            pips: {
                mode: 'values',
                values: [0, 10, 20, 30, 40, 50],
                density: 4
            }
        });
		lengthSlider.noUiSlider.on('update', function (values, handle) {
			length_field.innerHTML = values[handle];
		});
		
		noUiSlider.create(widthSlider, {
            start: [0],
			tooltips: true,
			connect: 'lower',
			behaviour: 'hover-snap',
            range: {
                'min': 0,
                'max': 50
            },
            pips: {
                mode: 'values',
                values: [0, 10, 20, 30, 40, 50],
                density: 4
            }
        });
		widthSlider.noUiSlider.on('update', function (values, handle) {
			width_field.innerHTML = values[handle];
		});
		
		noUiSlider.create(heightSlider, {
            start: [0],
			tooltips: true,
			connect: 'lower',
			behaviour: 'hover-snap',
            range: {
                'min': 0,
                'max': 25
            },
            pips: {
                mode: 'values',
                values: [0, 5, 10, 15, 20, 25],
                density: 4
            }
        });
		heightSlider.noUiSlider.on('update', function (values, handle) {
			height_field.innerHTML = values[handle];
		});

		////////////////////
        // Document Load  //
        ////////////////////
        
        // ???????????????? We want a table to be loaded when the webpage is loaded right ?????????????????????
        // We should do that in the document.ready
        $(document).ready(function() {
            // Ajax call to populate table first with 2015 data
            // $.get("https://bioed.bu.edu/cgi-bin/students_24/Team_7/coral_cgi.py",
            //     {'selector':'default_query'},
            //     function(data){
            //         create_table(data)},
            //     "json");

            // Ajax to fill in dropdown menu
        
        })

        ////////////////////
        // AAAAJJJAAAXXXX //
        ////////////////////
        $("#get_table_button").click(function(){
            // Empty data table
            $("#out_table").empty();
            
            // Retrieve all filters
            let tagid = $("#tagid").val();
            let scaffoldid = $("#scaffold").val();
            
            let year_array = [];
            $("input:checkbox[name=year]:checked").each(function() { 
                year_array.push($(this).val()); 
            }); 
            let years = year_array.join(':');
                


            let location_array = [];
            $("input:checkbox[name=location]:checked").each(function() { 
                location_array.push($(this).val()); 
            }); 
            
            let mortality_array = [];
            $("input:checkbox[name=mortality]:checked").each(function() { 
                mortality_array.push($(this).val()); 
            }); 

            let length_val = $("#length_value").val();
            let width_val = $("#width_value").val();
            let height_val = $("#height_value").val();
            let eco_vol_val = $("#eco_vol_value").val();
            let ln_eco_vol_val = $("#ln_eco_vol_value").val();
            let allele_freq = $("#allele_freq_value").val();
            


            // AJAX call
            $.get("https://bioed.bu.edu/cgi-bin/students_24/saumyapo/coral_cgi.py",
                {'tagid':tagid,
                    'scaffoldid':scaffoldid,
                    'year_array':years,
                    'location':location_array,
                    'mortality':mortality_array,
                    'eco_vol_val':eco_vol_val,
                    'ln_eco_vol_val':ln_eco_vol_val,
                    'allele_freq':allele_freq,
                    'length_val':length_val,
                    'width_val':width_val,
                    'height_val':height_val,
                    'vcf':vcf
                },
                function(data){
                    create_table(data)
                },
                "json");
        })

        //////////////////////////////////////
        // Create table from returned query //
        //////////////////////////////////////
        function create_table(json) {
            
            // Initialize variable to store HTML table
            let table_body_contents = "";

            // ????????????????? STORE QUERY RESULTS FOR DOWNLOAD ????????????????????
            // Is this the best way to implement this? <div id="store_results">...</div>
            //$("#store_results").append(json);
            
            // ???????????? NEEDS MAJOR WORK?????????????????
            // When am I supposed to include VCF column?
            for (let row= 0; row<json.length; row++) {

                let tagid = json[row][0];
                let loc = json[row][1];
                let notes = json[row][2];
                let alive_status = json[row][3];
                let length_cm = json[row][4];
                let width_cm = json[row][5];
                let height_cm = json[row][6];
                let eco_volume = json[row][7];
                let ln_eco_volume = json[row][8];
                let volume_cylinder = json[row][9];
                let tip_number = json[row][10];
                let old_tag = json[row][11];
                let year = json[row][12];
                
                table_body_contents +=  `<tr>
                                            <td>${tagid}</td>
                                            <td>${loc}</td>
                                            <td>${notes}</td>
                                            <td>${alive_status}</td>
                                            <td>${length_cm}</td>
                                            <td>${width_cm}</td>
                                            <td>${height_cm}</td>
                                            <td>${eco_volume}</td>
                                            <td>${ln_eco_volume}</td>
                                            <td>${volume_cylinder}</td>
                                            <td>${tip_number}</td>
                                            <td>${old_tag}</td>
                                            <td>${year}</td>
                                        </tr>`;
            }

                var table_template = ` <div class="scroll"> 
										<table>
                                            <thead>
                                                <tr>
                                                    <th>Tag ID</th>
                                                    <th>Location</th>
                                                    <th>Notes</th>
                                                    <th>Alive Status</th>
                                                    <th>Length (cm)</th>
                                                    <th>Width (cm)</th>
                                                    <th>Height (cm)</th>
                                                    <th>Ecological Volume</th>
                                                    <th>ln(Ecological Volume)</th>
                                                    <th>Volume Cylinder</th>
                                                    <th>Tip Number</th>
                                                    <th>Old Tag</th>
                                                    <th>Year</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${table_body_contents}
                                            </tbody>
                                        </table>
										</div>`;

                $("#out_table").append(table_template);
        }


    </script>
<br><br><br>
</body>
</html>
